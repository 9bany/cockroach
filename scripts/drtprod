#!/usr/bin/env bash

# drtprod is a wrapper for roachprod for use when managing the long-lived DRT
# clusters that ensures consistent use of the correct project-assignment vars
# and done some additional sanity check enforcement on some flags.

case $1 in
  "start")
    if [[ "$*" != *"--secure"* ]]; then
      echo "--secure is implied when starting DRT clusters, adding it"
      set -- "$@" "--secure"
    fi
    if [[ "$*" != *"--sql-port 26257"* ]]; then
     echo "--sql-port 26257 is implied when starting DRT clusters, adding it"
      set -- "$@" "--sql-port" "26257"
    fi
    ;;
  "sql")
    if [[ "$*" != *"--secure"* ]]; then
      set -- "$@" "--secure"
    fi
    ;;
esac


GCE_PROJECT=cockroach-drt  ROACHPROD_DNS="drt.crdb.io" roachprod "$@"
