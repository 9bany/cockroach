skip_under_ci
----

# This test applies a configuration that prioritizes zone constraints, favoring
# the US_East region. As a result, we expect a majority of replicas to be
# distributed across stores numbered 1-12, all within the US_East region. The
# allocation of replicas to stores outside of this region is expected to be
# zero.

load_cluster config=multi_region
----

# Create 200 ranges (RF=3) with zone preference set to US_East.
set_span_config delay=1m
[0,9999999999): num_replicas=3 constraints={'+region=US_East'}
----

assertion type=conformance under=0 violating=0
----

gen_ranges ranges=200
----

# Stores=(13-25) should have number of replicas close to zero.
assertion type=stat stat=replicas ticks=5 exact_bound=0 stores=(13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30)
----

eval duration=10m samples=1 seed=42 metrics=(replicas) cfgs=(sma-count,mma-only)
----
replicas#1: first: [s1=17, s2=17, s3=17, s4=17, s5=17, s6=16, s7=16, s8=17, s9=17, s10=17, s11=17, s12=17, s13=16, s14=16, s15=16, s16=16, s17=17, s18=17, s19=17, s20=16, s21=17, s22=16, s23=17, s24=17, s25=17, s26=17, s27=17, s28=16, s29=17, s30=16, s31=17, s32=17, s33=16, s34=16, s35=17, s36=17] (stddev=0.47, mean=16.67, sum=600)
replicas#1: last:  [s1=51, s2=50, s3=52, s4=51, s5=49, s6=49, s7=50, s8=49, s9=49, s10=50, s11=48, s12=52, s13=0, s14=0, s15=0, s16=0, s17=0, s18=0, s19=0, s20=0, s21=0, s22=0, s23=0, s24=0, s25=0, s26=0, s27=0, s28=0, s29=0, s30=0, s31=0, s32=0, s33=0, s34=0, s35=0, s36=0] (stddev=23.58, mean=16.67, sum=600)
replicas#1: thrash_pct: [s1=33%, s2=0%, s3=60%, s4=0%, s5=29%, s6=42%, s7=0%, s8=17%, s9=35%, s10=37%, s11=65%, s12=62%, s13=31%, s14=31%, s15=31%, s16=31%, s17=33%, s18=33%, s19=33%, s20=31%, s21=33%, s22=31%, s23=33%, s24=33%, s25=33%, s26=33%, s27=33%, s28=31%, s29=33%, s30=31%, s31=33%, s32=33%, s33=31%, s34=31%, s35=33%, s36=33%]  (sum=1144%)
artifacts[sma-count]: d14df5e462a2e42b
==========================
replicas#1: first: [s1=17, s2=17, s3=17, s4=17, s5=17, s6=16, s7=16, s8=17, s9=17, s10=17, s11=17, s12=17, s13=16, s14=16, s15=16, s16=16, s17=17, s18=17, s19=17, s20=16, s21=17, s22=16, s23=17, s24=17, s25=17, s26=17, s27=17, s28=16, s29=17, s30=16, s31=17, s32=17, s33=16, s34=16, s35=17, s36=17] (stddev=0.47, mean=16.67, sum=600)
replicas#1: last:  [s1=66, s2=37, s3=42, s4=40, s5=45, s6=50, s7=38, s8=47, s9=62, s10=60, s11=61, s12=52, s13=0, s14=0, s15=0, s16=0, s17=0, s18=0, s19=0, s20=0, s21=0, s22=0, s23=0, s24=0, s25=0, s26=0, s27=0, s28=0, s29=0, s30=0, s31=0, s32=0, s33=0, s34=0, s35=0, s36=0] (stddev=24.23, mean=16.67, sum=600)
replicas#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%, s11=0%, s12=0%, s13=24%, s14=24%, s15=24%, s16=24%, s17=26%, s18=26%, s19=26%, s20=24%, s21=26%, s22=24%, s23=26%, s24=26%, s25=26%, s26=26%, s27=26%, s28=24%, s29=26%, s30=24%, s31=26%, s32=26%, s33=24%, s34=24%, s35=26%, s36=26%]  (sum=603%)
artifacts[mma-only]: 827a1fa368c62005
==========================
